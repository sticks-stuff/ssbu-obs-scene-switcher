<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<style>
	* {
		font-size: 20px;
	}
	h1, button {
		font-size: 60px;
	}
</style>
<body>
	<button id="update-bracket" onclick="updateBracket()">UPDATE BRACKET MANUALLY</button>
	<br>
	(the bracket should also update when the bracket scene is switched to)
	<br>
	<h1>PLEASE ADD YOURSELF AS A COMMENTATOR IF YOU ARE COMMENTATING</h1>
	<h1>REMOVE YOURSELF ONCE YOU ARE DONE</h1>
	<img src="assets/Screenshot_197.png" width="900">
	<img src="assets/Screenshot_198.png" width="900">
	<img src="assets/Screenshot_199.png" width="900">
	<br>
	If you can switch to the "Between Games" scene between games that would be sick.
	<br>
	After a game is finished you can switch to the "Coming Up" scene and edit the text in !!! EDIT ME !!! with the next game.
	<br>
	If you can, make sure the game logo in "Between Games" is shown.
	<br>
	If you can, set the team/player color using the colors below to match the colors in the game (click the colored box next to "Team 1", then click "Pick screen color, then click on one of these boxes)
	<br>
	Thanks so much for commentating Jank Season!
	<br>
	<i>- sharlot</i>
	<h1>ROA COLORS</h1>
	<div style="width: 100px; height: 100px; background-color: #ED1C23;"></div> 
	<div style="width: 100px; height: 100px; background-color: #00B7EF;"></div> 
	<div style="width: 100px; height: 100px; background-color: #FFA3B1;"></div> 
	<div style="width: 100px; height: 100px; background-color: #A8E61D;"></div> 
	<h1>BRAWL MINUS COLORS</h1>
	<div style="width: 100px; height: 100px; background-color: #FF0000;"></div> 
	<div style="width: 100px; height: 100px; background-color: #4753FF;"></div> 
	<div style="width: 100px; height: 100px; background-color: #FFBB0F;"></div> 
	<div style="width: 100px; height: 100px; background-color: #249F3F;"></div> 
	<h1>ULTI TEAM COLORS</h1>
	<div style="width: 100px; height: 100px; background-color: #fe3636;"></div> 
	<div style="width: 100px; height: 100px; background-color: #2e89ff;"></div> 
	<div style="width: 100px; height: 100px; background-color: #ffbb10;"></div> 
	<div style="width: 100px; height: 100px; background-color: #28b448;"></div> 
</body>
<script src="node_modules/obs-websocket-js/dist/obs-ws.min.js"></script>
<script>
	const OBS_IP = 'localhost';
	const OBS_PORT = 4455;
	const CAM_LEFT_GROUP = "Left-Cam";
	const CAM_RIGHT_GROUP = "Right-Cam";
	const CAM_P1 = "P1-Cam";
	const CAM_P2 = "P2-Cam";
	let CAM_LEFT_P1;
	let CAM_LEFT_P2;
	let CAM_RIGHT_P1;
	let CAM_RIGHT_P2;
	let OBS;

	(async () => {
		let response = await fetch("./env.json");
		response = await response.json();
		const OBS_PASSWORD = response.OBS_PASSWORD;
		console.log(OBS_PASSWORD);
		
		try {
			obs = new OBSWebSocket();
			await obs.connect(`ws://${OBS_IP}:${OBS_PORT}`, OBS_PASSWORD);
			console.log('Connected to OBS');
			let response = await obs.call('GetSceneItemList', {
				'sceneName': CAM_LEFT_GROUP
			})
			response.sceneItems.forEach(item => {
				console.log({item})
				if(item.sourceName == CAM_P1) {
					CAM_LEFT_P1 = item.sceneItemId;
				}
				if(item.sourceName == CAM_P2) {
					CAM_LEFT_P2 = item.sceneItemId;
				}
			});
			response = await obs.call('GetSceneItemList', {
				'sceneName': CAM_RIGHT_GROUP
			})
			response.sceneItems.forEach(item => {
				if(item.sourceName == CAM_P1) {
					CAM_RIGHT_P1 = item.sceneItemId;
				}
				if(item.sourceName == CAM_P2) {
					CAM_RIGHT_P2 = item.sceneItemId;
				}
			});
			document.getElementsByTagName("body")[0].innerHTML = "<button onclick='swap()'>SWAP PLAYER CAMS</button><br>" + document.getElementsByTagName("body")[0].innerHTML;
			swap();
		} catch (error) {
			// document.write(error);
		}
	})();

	async function swap() {
		response = await obs.call('GetSceneItemEnabled', {
			'sceneName': CAM_RIGHT_GROUP,
			'sceneItemId': CAM_RIGHT_P1
		})
		if(response.sceneItemEnabled) {
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_RIGHT_GROUP,
				'sceneItemId': CAM_RIGHT_P1,
				'sceneItemEnabled': false
			})
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_RIGHT_GROUP,
				'sceneItemId': CAM_RIGHT_P2,
				'sceneItemEnabled': true
			})
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_LEFT_GROUP,
				'sceneItemId': CAM_LEFT_P1,
				'sceneItemEnabled': true
			})
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_LEFT_GROUP,
				'sceneItemId': CAM_LEFT_P2,
				'sceneItemEnabled': false
			})
		} else {
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_RIGHT_GROUP,
				'sceneItemId': CAM_RIGHT_P1,
				'sceneItemEnabled': true
			})
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_RIGHT_GROUP,
				'sceneItemId': CAM_RIGHT_P2,
				'sceneItemEnabled': false
			})
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_LEFT_GROUP,
				'sceneItemId': CAM_LEFT_P1,
				'sceneItemEnabled': false
			})
			await obs.call('SetSceneItemEnabled', {
				'sceneName': CAM_LEFT_GROUP,
				'sceneItemId': CAM_LEFT_P2,
				'sceneItemEnabled': true
			})
		}
	}
	function updateBracket() {
		document.getElementById("update-bracket").innerHTML = "UPDATING BRACKET...";
		fetch('http://127.0.0.1:5000/update-bracket').then(response => {
			document.getElementById("update-bracket").innerHTML = "UPDATE BRACKET";
		})
	}
</script>
</html>
